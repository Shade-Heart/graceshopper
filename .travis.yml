language: node_js
node_js:
  - node # uses most recent stable node version
services:
  - postgresql # starts up postgres
addons:
  postgresql: '9.6' # highest available postgres version on Travis
dist: trusty # uses trusty environment
sudo: false # when on trusty, uses Docker containers for speed
notifications:
  email:
    on_success: change # default: change (only when going from broken to fixed)
    on_failure: always # default: always (which is annoying, as it should be)
install:
  - npm ci # faster, goes only from package-lock
before_script:
  - psql -c 'create database "graceshopper-test";' -U postgres # remember to change this name if you change it elsewhere (e.g. package.json)

before_deploy:
  - npm run build-client # make the bundle
  - rm -rf node_modules # omit from the tarball, since we skip cleanup
deploy:
  skip_cleanup: true # prevents travis from deleting the build
  provider: heroku
  app: mad-hatters # see README
  api_key:
    secure: "KnUIqon+2QY1/X6ud0SSpm3yQAA8Vdii9Zd3jQUBHMoIwDmkEB9zAdpYLcugv4FeVXPJTU8LxDT614ynL4jRYH88Ew/8HEjlp1oOlXDqYVfsNykO4woLsu+KW0ouZXRO8N8MqPGaBAFmY8TF7gz1wo6kAklbp03iWII5ZQnYQwU7CG33NXdkDT0jP5NuOKbo37h7DZTvXnGEzOFozvozNGI7DmGUQnnTAZ4mTzR/RATHaVxifFit5qCeONY+MtoSgyxBB7abmG7d60LWI+gtHNhEUpcv2uAitS/a6l1MKGgTtWf1tdOIAYblA9JaO0jKCDtcObigrrsUW9UiIsq1abqo87ANXyuuCTYWvQwFgmM2spiGD4ml2TxHZDM2+KDQBeFODwAHRsRdjM+Kbz6SuYbpJjDgWTQsXT/lWmnDkgyOV7rA5ZXsa0K78B3WU6wqVlUwe+nqb3FNCJYm4ob7eQ8q4nXmNEHjszWC2TKUd4AfN1bgXLaZtiV0S7cQ4DLZ3s2F8kN6IfbMfzYhmL02F+43vtqwjx1Zms3cEnHOFzsyNSeGl2/srac9Aar9upYwBoSqZ0Cb53p9c+3Oz42OHwcGyiDDdsb9bOic3vzrTLQhDNbDheyqu4fUA0BaQ6h9/B05W/9EGrfHDUou27Kqm+MbNc3NYfzF6Dm36MsCh4c="
